version: '3.8'

services:
  svelte-dashboard:
    build:
      context: .
      dockerfile: Dockerfile.dev
    container_name: ha-svelte-dashboard-dev
    ports:
      - "8080:8080"
      - "3001:3001"
    volumes:
      - ./src:/app/src
      - ./server:/app/server
      - ./data:/app/data
      - ./index.html:/app/index.html
      - ./vite.config.js:/app/vite.config.js
      - ./scripts:/app/scripts
      - ./package.json:/app/package.json
    environment:
      - HA_URL=http://192.168.1.222:8123
      - HA_TOKEN=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJkMTY4YjhmZDU1YTY0YzhkYmJhNDY3ODZkNTM1MWU5MyIsImlhdCI6MTc2MzU5MTMwMCwiZXhwIjoyMDc4OTUxMzAwfQ.Vyz4iRVr93i-LXo_6sg-nENo-TgTmrxPa1vhXDjWVLs
      - GEMINI_API_KEY=AIzaSyB3MR3Qs23ksBd9lBSxh0OnDhzgmNrMTag
      - LOCATION=Miami, FL
      - NODE_OPTIONS=--max-old-space-size=192
    restart: unless-stopped
    depends_on:
      - go2rtc
    networks:
      - streaming

  go2rtc:
    image: alexxit/go2rtc:latest
    container_name: go2rtc
    restart: unless-stopped
    ports:
      - "1984:1984"   # API
      - "8555:8555"   # WebRTC
      - "8888:8888"   # HLS/MSE
    volumes:
      - ./go2rtc.yaml:/config/go2rtc.yaml
    environment:
      - CONFIG=/config/go2rtc.yaml
    networks:
      - streaming

networks:
  streaming:
    driver: bridge
