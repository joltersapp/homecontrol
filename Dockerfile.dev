FROM node:20-alpine

# Install build dependencies for native modules and timezone data
RUN apk add --no-cache python3 make g++ tzdata

WORKDIR /app

# Copy package files and install dependencies
COPY package.json package-lock.json ./
RUN npm install

# Rebuild native modules for Alpine Linux
RUN npm rebuild better-sqlite3

# Copy all source code for hot reload
COPY . .

# Expose port 8080 for Vite
EXPOSE 8080

# Run both Vite and backend server via concurrently
CMD ["npm", "run", "dev"]
